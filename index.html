<!DOCTYPE html>
<html>
<body style="background: #1a1a1a; color: white; font-family: monospace; text-align: center; padding: 20px;">

    <header><h1>Image to ASCII Art</h1></header>

    <div style="display: inline-block; text-align: left; margin-bottom: 20px;">
        <div id="char-list" style="font-size: 14px; white-space: nowrap; margin-bottom: 5px;">
            $@B%8&WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft/\|()1{}[]?-_+~<>i!lI;:,"^`'.
        </div>
        <div style="height: 10px; width: 100%; background: linear-gradient(to right, rgb(255, 255, 255), rgb(0, 0, 0)); border: 1px solid #444;"></div>
    </div>

    <br>
    <input type="file" id="upload" accept="image/*">

    <div style="margin-top: 20px;">
        <label for="width-slider">width: <span id="width-value">100</span></label>
        <input type="range" id="width-slider" min="50" max="200" value="100" step="10">
    </div>

    <div style="margin-top: 20px; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
        <div>
            <p>Black-white:</p>
            <canvas id="bw-canvas" style="border: 2px solid #2ecc71; max-width: 300px;"></canvas>
        </div>
        <div>
            <p>ASCII Output:</p>
            <pre id="ascii-output" style="font-size: 8px; line-height: 8px; background: black; color: white; padding: 10px; text-align: left;"></pre>
        </div>
    </div> 

    <script>
        const upload = document.getElementById('upload');
        const canvas = document.getElementById('bw-canvas');
        const ctx = canvas.getContext('2d');
        const asciiOutput = document.getElementById('ascii-output');
        const charList = document.getElementById('char-list').innerText.trim();
        const widthSlider = document.getElementById('width-slider');
        const widthValue = document.getElementById('width-value');

        let currentImg = null; // Om de afbeelding op te slaan voor herverwerking

        // Functie om de afbeelding te verwerken
        function processImage(img) {
            const width = parseInt(widthSlider.value); // Gebruik slider-waarde voor breedte (aantal karakters)
            const scale = width / img.width;
            const height = img.height * scale * 0.55;
            
            canvas.width = width;
            canvas.height = height;

            ctx.drawImage(img, 0, 0, width, height);

            const imageData = ctx.getImageData(0, 0, width, height);
            const data = imageData.data; 

            let asciiArt = "";

            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const i = (y * width + x) * 4;
                    const r = data[i];
                    const g = data[i + 1];
                    const b = data[i + 2];
                    const avg = r * 0.2126 + g * 0.7152 + b * 0.0722;

                    let charIndex = Math.floor((avg / 255) * charList.length);
                    if (charIndex >= charList.length) charIndex = charList.length - 1;

                    const char = charList[charIndex];
                    asciiArt += char !== undefined ? char : " ";
                }
                asciiArt += "\n";
            }

            asciiOutput.innerText = asciiArt;

            // Zwart-wit maken
            for (let i = 0; i < data.length; i += 4) {
                const avg = (data[i] + data[i+1] + data[i+2]) / 3;
                data[i] = data[i+1] = data[i+2] = avg;
            }
            ctx.putImageData(imageData, 0, 0);
        }

        // Slider event: update waarde en herverwerk indien afbeelding geladen
        widthSlider.oninput = function() {
            widthValue.innerText = this.value;
            if (currentImg) {
                processImage(currentImg);
            }
        };

        upload.onchange = function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        currentImg = img; // Sla de afbeelding op
                        processImage(img);
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        };
    </script>
</body>
</html>