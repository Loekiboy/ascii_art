<!DOCTYPE html> 
<html>
<body style="background: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: monospace; text-align: center;">

    <header>image to Ascii art</header>

    <div style="display: inline-block; text-align: left;">
        
        <div style="font-size: 20px; white-space: nowrap; margin-bottom: 5px;">
            $@B%8&WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft/\|()1{}[]?-_+~<>i!lI;:,"^`'.
        </div>

        <div style="height: 20px; width: 100%; background: linear-gradient(to right, black, white); border: 1px solid #444;"></div>

        <input type="file" id="upload" accept="image/*">

        <div style="margin-top: 20px;">
            <p>Preview:</p>
            <img id="preview" style="max-width: 300px; border: 2px solid #555; display: none;">
</div>

<script>
    const upload = document.getElementById('upload');
    const preview = document.getElementById('preview');

    upload.onchange = function(e) {
        const file = e.target.files[0];
        
        if (file) {
            const reader = new FileReader();

            reader.onload = function(event) {
                preview.src = event.target.result;
                preview.style.display = 'inline-block';
            };

            reader.readAsDataURL(file);
        }
    };
</script>
        
<div style="margin-top: 20px;">
    <p>Black-white:</p>
    <canvas id="bw-canvas" style="border: 2px solid #2ecc71; max-width: 300px;"></canvas> 
</div>

<script>
    const canvas = document.getElementById('bw-canvas');
    const ctx = canvas.getContext('2d');

    upload.onchange = function(e) {
        const file = e.target.files[0];
        
        if (file) {
            const reader = new FileReader();

            reader.onload = function(event) {
                // 1. Toon de originele preview
                preview.src = event.target.result;
                preview.style.display = 'inline-block';

                // 2. Maak een nieuw image-object voor de bewerking
                const img = new Image();
                img.onload = function() {
                    // Stel canvas grootte in
                    canvas.width = img.width;
                    canvas.height = img.height;

                    // Teken en bewerk pixels
                    ctx.drawImage(img, 0, 0);
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;

                    for (let i = 0; i < data.length; i += 4) {
                        const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                        data[i]     = avg; // R
                        data[i + 1] = avg; // G
                        data[i + 2] = avg; // B
                    }

                    ctx.putImageData(imageData, 0, 0);
                };
                img.src = event.target.result; // Dit triggert img.onload
            };

            reader.readAsDataURL(file);
        }
    };
</script>
    </div>
    
</body>
</html>